<!DOCTYPE html>
<html>
<head>
    <title>Direct Search Test</title>
</head>
<body>
    <h1>Direct Search Test</h1>
    <input id="search-input" type="text" placeholder="Type 'a' to test">
    <div id="search"></div>
    <div id="main-content">Main content here</div>
    
    <div id="results"></div>
    
    <script>
        // Load the search index directly
        fetch('http://localhost:3000/docs/search.js')
            .then(response => response.text())
            .then(jsContent => {
                // Execute the search.js content to get SEARCH_INDEX
                eval(jsContent);
                
                document.getElementById('results').innerHTML += 'SEARCH_INDEX loaded: ' + (typeof SEARCH_INDEX !== 'undefined') + '<br>';
                
                if (typeof SEARCH_INDEX !== 'undefined') {
                    document.getElementById('results').innerHTML += 'SEARCH_INDEX keys: ' + Object.keys(SEARCH_INDEX).join(', ') + '<br>';
                    
                    // Test search for 'a'
                    const query = 'a';
                    const results = [];
                    
                    for (const crate in SEARCH_INDEX) {
                        const items = SEARCH_INDEX[crate] || [];
                        for (const item of items) {
                            if (item.name.toLowerCase().includes(query.toLowerCase())) {
                                results.push(item.name);
                            }
                        }
                    }
                    
                    results.sort();
                    const first10 = results.slice(0, 10);
                    
                    document.getElementById('results').innerHTML += 'Found ' + results.length + ' results for "a"<br>';
                    document.getElementById('results').innerHTML += 'First 10: ' + first10.join(', ') + '<br>';
                    
                    // Test the actual search functionality
                    const searchInput = document.getElementById('search-input');
                    const searchSection = document.getElementById('search');
                    const mainSection = document.getElementById('main-content');
                    
                    searchInput.addEventListener('input', function(e) {
                        const query = e.target.value;
                        document.getElementById('results').innerHTML += 'Input event: "' + query + '"<br>';
                        
                        if (!query.trim()) {
                            searchSection.innerHTML = '';
                            searchSection.style.display = 'none';
                            mainSection.style.display = 'block';
                            return;
                        }
                        
                        const searchResults = [];
                        const queryLower = query.toLowerCase();
                        
                        for (const crate in SEARCH_INDEX) {
                            const items = SEARCH_INDEX[crate] || [];
                            for (const item of items) {
                                let score = 0;
                                const name = item.name.toLowerCase();
                                
                                if (name === queryLower) score += 100;
                                else if (name.startsWith(queryLower)) score += 50;
                                else if (name.includes(queryLower)) score += 25;
                                
                                if (score > 0) {
                                    searchResults.push({ ...item, score });
                                }
                            }
                        }
                        
                        searchResults.sort((a, b) => b.score - a.score);
                        const topResults = searchResults.slice(0, 10);
                        
                        document.getElementById('results').innerHTML += 'Found ' + topResults.length + ' results<br>';
                        
                        if (topResults.length === 0) {
                            searchSection.innerHTML = '<div style="padding: 20px;"><h2>No results found for "' + query + '"</h2></div>';
                        } else {
                            const resultsHtml = topResults.map(item => {
                                return '<div style="padding: 10px; border-bottom: 1px solid #ccc;">' +
                                       '<strong>' + item.name + '</strong> (' + (item.type_name || '') + ')</div>';
                            }).join('');
                            
                            searchSection.innerHTML = '<div style="padding: 10px;"><h2>Results for "' + query + '":</h2></div>' + resultsHtml;
                        }
                        
                        searchSection.style.display = 'block';
                        mainSection.style.display = 'none';
                    });
                    
                    document.getElementById('results').innerHTML += '<br><strong>Ready! Type "a" in the search box above.</strong><br>';
                }
            })
            .catch(error => {
                document.getElementById('results').innerHTML += 'Error loading search.js: ' + error + '<br>';
            });
    </script>
</body>
</html>